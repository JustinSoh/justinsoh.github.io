<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>justinsoh</title>
    <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet"
        type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link rel="stylesheet" href="../css/font-mfizz.css">
    <link href="../css/styles.css" rel="stylesheet" />
</head>

<body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">
            <span class="d-block d-lg-none">Justin Soh</span>
            <span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2"
                    src="../assets/img/profile2.png" alt="..." /></span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
            aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span
                class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="../index.html#about">About</a></li>
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="../index.html#projects">Projects</a></li>
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="../index.html#skills">Skills</a></li>
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="../index.html#experience">Experience</a></li>
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="../index.html#education">Education</a></li>
<!--                 
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#interests">Interests</a></li>
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#awards">Awards</a></li> -->
            </ul>
        </div>
    </nav>
    <!-- Page Content-->
    <div class="container-fluid p-0">
        <!-- About-->
        <section class="resume-section" id="about">
            <div class="resume-section-content">
                <h1 class="mb-0">
                    ICMP Smuggler
                </h1>
                <div class="subheading mb-5">
                    Personal Project exploring Data Exfiltration Techniques
                    <ul class="list-inline dev-icons">
                        <li class="list-inline-item"><i class="icon-python"></i></li>
                    </ul>
                </div>
                <p class="lead mb-5">
                    <img class="img-fluid" src="../assets/img/icmp_smuggler_wireshark.png"></img>
                    <br><br>
                    This proof of concept demonstrates data exfiltration via ICMP as a covert channel. 
                    By exploiting the ICMP payload, this POC enables the sender to craft a malicious ICMP packet to retrieve a specific file 
                    from the target machine. The target machine, which runs the receiver, then transmits the packet back to the sender who reassembles it.
                    <h3 class="mb-0">
                        <span class="text-primary">Motivation
                        behind project</span>
                    </h3>
                    <div>
                        I began this project after an intriguing conversation brought back memories of an attack scenario from one of my training sessions. During that discussion, I was primarily focused on understanding attackers' actions and objectives, particularly how they manage to steal data.
                        <br><br>
                        While using Moloch, a network traffic analyzer, I noticed a significant increase in traffic over a specific period of time. Upon investigating further, I discovered that the data was being secretly sent out using ICMP.
                        This led me to develop the ICMP Smuggler project, aimed at simulating and exploring how data exfiltration operates through covert channels like ICMP.
                        <br><br>
                    </div>
                    <h3 class="mb-0">
                        <span class="text-primary">The Goal</span>
                    </h3>
                    <div>
                        <img class="img-fluid" src="../assets/img/icmp_smuggler_overview.png"></img>
                        The ultimate goal of the ICMP Smuggler was for the sender to send a command and exfiltrate data from the receiver. In this case, the aim is to retrieve proof.txt, 
                        which is located on the target system, and transfer it to our sender system via ICMP.
                    </div>
                    <br><br>
                    <h3 class="mb-0">
                        <span class="text-primary">Part 1: Development of Sender.py</span>
                    </h3>
                    <div>
                        The sender.py project started by building and sending a special ICMP packet step by step. This part was done quickly, and I made sure it worked by checking the Wireshark data on the target system.
                        Knowing that plain text commands are easy to spot, I decided to encode the commands using base64. Additionally, I also implemented the ability to send commands in smaller chunks, making it tougher for blue teamers to catch on.
                    </div>
                    <br><br>
                    <h3 class="mb-0">
                        <span class="text-primary">Part 2: Development of Receiver.py</span>
                    </h3>
                    <div>
                        <img class="img-fluid" src="../assets/img/icmp_smuggler_requestflow.png"></img>
                        Since I knew the receiver could receive my customized ICMP payload, I decided to use Scapy's sniff function to further process this. 
                        This function helped me filter and decode ICMP packets. However, I faced a big challenge: if I sent data in pieces, how would I know where each piece started and ended?
                        To tackle this, I implemented session tracking. This way, the sender would "tell" the receiver when a packet was coming and when the transmission was finished.
                    </div>
                    <br><br>
                    <h3 class="mb-0">
                        <span class="text-primary">Part 3: Getting sender.py to receive a response from receiver.py</span>
                    </h3>
                    <div>
                        As the receiver was now capable of receiving data, my focus shifted to enabling the receiver to respond. However, this proved challenging because when an ICMP Type 8 request is sent to your computer, it usually triggers an ICMP Type 0 reply. Consequently, my attempts to send a reply were constantly being interfered with by the automatic system reply.

                        <br><br>To avoid meddling with system settings, I implemented threading in sender.py to sniff while sending the command. This approach worked well, but I needed a way to close the loop effectively.
                        
                        Fortunately, I came across online documentation explaining the stop filter method. I modified the program so that upon receiving the terminating sequence, it would stop sniffing and exit the program. This ensured a smoother operation without interfering with system settings.
                    </div>
                    <br><br>
                    <h3 class="mb-0">
                        <span class="text-primary">Part 4: Piecing it all together</span>
                    </h3>
                    <div>
                        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                            <ol class="carousel-indicators">
                              <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"></li>
                              <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"></li>
                              <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"></li>
                            </ol>
                            <div class="carousel-inner">
                              <div class="carousel-item active">
                                <img class="d-block w-100" src="../assets/img/icmp_smuggler_senderrecv.png" alt="First slide">
                                <div class="carousel-caption d-none d-md-block">
                                    <h3 style="color:white">sender.py</h3>
                                    <p>Sender requesting and receiving the proof.txt file</p>
                                </div>
                            </div>
                              <div class="carousel-item">
                                <img class="d-block w-100" src="../assets/img/icmp_smuggler_targetsend.png" alt="Second slide">
                                <div class="carousel-caption d-none d-md-block">
                                    <h3 style="color:white">receiver.py</h3>
                                    <p>Target receiving the command and sending the file over</p>
                                </div>
                              </div>
                              <div class="carousel-item">
                                <img class="d-block w-100" src="../assets/img/icmp_smuggler_wireshark_details.png" alt="Third slide">
                                <div class="carousel-caption d-none d-md-block">
                                    <h3 style="color:white">wireshark</h3>
                                    <p>the file captured over wireshark</p>
                                </div>
                              </div>
                            </div>
                            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-bs-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-bs-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="sr-only">Next</span>
                            </a>
                          </div>
                        Now that I could send a particular command to the target and receive a specific reply, I updated the sender to send payloads using the 'get [filename]' format. 
                        The receiver would then read the bytes of the file if it existed and send it back to the sender. 
                        With this modification, data exfiltration was successfully achieved! Yay!
                    </div>
                    <br><br>
                    <h3 class="mb-0">
                        <span class="text-primary">So what's next</span>
                    </h3>
                    <div>
                        This project has been an enjoyable journey, and it's clear that there's still much more to explore and develop. 
                        I'm excited about delving into the IOCs and artifacts associated with this smuggler, 
                        which will not only expand its capabilities but also deepen my understanding of its potential impact.

                        Additionally, I'm eager to leverage my interest in learning ReactJS to potentially create 
                        a GUI version of this tool. This aligns perfectly with my ambitions to broaden my skillset and delve deeper into front-end development.

                        Overall, this project has been incredibly educational and rewarding. I've gained valuable insights and knowledge along the way, and it's been a truly fulfilling experience. 
                        
                        If you're curious to give it a try, feel free to check out the project on my GitHub repository (link is below). Your feedback and contributions are always welcome!
                    </div>
                    <br><br>
                    <div class="social-icons">
                        <a class="social-icon" href="https://github.com/JustinSoh/icmpsmuggler"><i class="fab fa-github"></i></a>
                    </div>
                

    </div>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="../js/scripts.js"></script>
</body>

</html>